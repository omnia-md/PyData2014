% title: Engineering a full python stack for biophysical computation
% author: Kyle A. Beauchamp, Choderalab@MSKCC
% author: Slides here: http://tinyurl.com/n4vq9aj
% favicon: figures/membrane.png

---
title: Moore's Law


<center>
<img height=550 src=figures/moore_law.png />
</center>

<footer class="source"> 
http://en.wikipedia.org/wiki/Moore%27s_law
</footer>

---
title: Does Moore's law apply to medicine?

<center>
<img height=450 src=figures/drugs.jpg />
</center>


<footer class="source"> 
http://seniorhousingforum.net/
</footer>

---
title: New Drug Approvals: Stagnant

<center>
<img height=450 src=figures/new_mol_ent.jpg />
</center>

<footer class="source"> 
http://www.forbes.com/sites/matthewherper/2011/06/27/the-decline-of-pharmaceutical-researchmeasured-in-new-drugs-and-dollars/
</footer>
---
title: erooM's Law for R&D Efficiency

<center>
<img height=450 src=figures/eroom.png />
</center>


<footer class="source"> 
Scannell, 2012
</footer>

---
title: The current state of drug discovery
subtitle: $2,000,000, 000, 15 years, 95% fail rate

<center>
<img height=450 src=figures/cost_structure.jpg />
</center>

<footer class="source"> 
Paul, 2010
</footer>

---
title: Can computers help us design drugs?

<center>
<img height=475 src=figures/cruise.png />
</center>

<footer class="source"> 
Figure credit: @jchodera, Tom Cruise
</footer>

---
title: A brief introduction to biophysics
class: segue dark nobackground


---
title: Drugs bind proteins


<center>
<img height=430 src=figures/2HW0-covalent.png />
</center>


<footer class="source"> 
PDB Code: 2HWO.  Figure generated by @sonyahanson
</footer>


---
title: Challenges in molecular medicine

- Can we understand the microscopic behavior of proteins?
- Can we link nanoscale biophysics with human disease?
- Can we rationally engineer protein-drug binding?
- Can we design pharmacokinetics, toxicity, solubility?
- Can we predict and prevent drug resistance?

---
title: Our Toolbox: Molecular Dynamics

- Physics-based simulations
- Numerically integrate (classical) equations of motion
- Protein, water, salts, drugs

<div>
<video id="sampleMovie" class="center" src="movies/shaw-dasatanib-2.mov" loop=\"true\ autoPlay=\"true\  width="512" height="384"></video>
</div>


<footer class="source"> 
Shan et al: J. Am. Chem. Soc. (2011). DOI. 
</footer>

---
title: Software for Biophysics
class: segue dark nobackground

---
title: How to sample biological timescales?
subtitle: How many iterations?  10^12

<center>
<img height=450 src=figures/protein_timescales.jpg />
</center>

<footer class="source">
Church, 2011.
</footer>

---
title: OpenMM
subtitle: GPU accelerated molecular dynamics

- C++ library with Python wrappers
- Hardware backends for CUDA, OpenCL, CPU
- Speed, flexibility, extensibility, maintainability

<center>
<img height=300 src=figures/openmm.png />
</center>

<footer class="source"> 
openmm.org
</footer>

---
title: OpenMM Powers Folding@Home

- Largest distributed computing project
- 100,000+ CPUs, 10000+ GPUs, 40 petaflops!

<center>
<img height=300 src=figures/folding-icon.png />
</center>


<footer class="source"> 
http://folding.stanford.edu/ <br>
Gromacs also powers Folding@Home: http://gromacs.org/
</footer>

---
title: Trajectory munging with MDTraj
subtitle: Read, write, and analyze trajectories with only a few lines of Python.

- Multitude of formats (PDB, DCD, XTC, HDF, CDF, mol2)
- Geometric trajectory analysis (distances, angles, RMSD)
- Numpy / SSE kernels allow scaling to Folding@Home scale

<center>
<img height=200 src=figures/mdtraj_logo-small.png />
</center>

<footer class="source"> 
mdtraj.org
</footer>

---
title: Trajectory munging with MDTraj
subtitle: Read, write, and analyze trajectories with only a few lines of Python.

<pre class="prettyprint" data-lang="python">

import mdtraj as md

trajectory = md.load("./trajectory.h5")
indices, phi = md.compute_phi(trajectory)

</pre>

<footer class="source"> 
mdtraj.org
</footer>

---
title: MSMBuilder / Mixtape
subtitle: sklearn-compatible machine learning models for conformation dynamics



<center>
<img height=300 src=figures/msmbuilder.png />
</center>


<footer class="source"> 
msmbuilder.org <br>
https://github.com/rmcgibbo/mixtape
</footer>


---
title: MSMBuilder / Mixtape
subtitle: sklearn-compatible machine learning models for conformation dynamics

<pre class="prettyprint" data-lang="python">

import mdtraj as md
from mixtape import datasets, cluster, markovstatemodel
from sklearn.pipeline import Pipeline

trajectories = datasets.alanine_dipeptide.fetch_alanine_dipeptide()["trajectories"]

clusterer = cluster.KCenters(n_clusters=10, metric=md.rmsd)
msm = markovstatemodel.MarkovStateModel()

pipeline = Pipeline([("clusterer", clusterer), ("msm", msm)])
pipeline.fit(trajectories)

</pre>

<footer class="source"> 
msmbuilder.org <br>
https://github.com/rmcgibbo/mixtape
</footer>

---
title: Yank
subtitle: Fast, accurate alchemical ligand binding simulations


<center>
<div>
<video id="sampleMovie" class="center" src="movies/alch.mov" loop=\"true\ autoPlay=\"true\  width="512" height="384"></video>
</div>
</center>


<footer class="source"> 
https://github.com/choderalab/yank
</footer>

---
title: Python Packaging Blues
class: segue dark nobackground

---
title: Building scientific software is hard!

<pre>

<font color="red">Him: I couldn't really install the mdtraj module on my computer [...]
Him: I tried easy_install and other things and that didn't work for me.</font>

</pre>

---
title: Building scientific software is hard!
subtitle: 2008: I was compiling BLAS / Numpy / Scipy by hand...


<center>
<img height=520 src=figures/dependencies0.png />
</center>

<footer class="source"> 
Red means hard to install.
</footer>


---
title: Building scientific software is hard!
subtitle: 2010: Switched to Enthought python

<center>
<img height=520 src=figures/dependencies1.png />
</center>

<footer class="source"> 
Red means hard to install.
</footer>

---
title: Building scientific software is hard!
subtitle: Present: Conda


<center>
<img height=520 src=figures/dependencies2.png />
</center>

<footer class="source"> 
Red means hard to install.
</footer>

---
title: Avoiding glibc Hell

<pre class="prettyprint" data-lang="bash">

-bash-4.1$ parmchk2
~/opt/bin/parmchk2_pvt: /lib64/libc.so.6: version `GLIBC_2.14' not found
</pre>

- Problem: users insist on old Linux versions
- Solution: build all recipes on a Centos 6.5 VM 

<footer class="source"> 
https://github.com/omnia-md/virtual-machines/
</footer>

---
title: CI, Testing, and Packaging

- Travis
- Jenkins
- Binstar Build?

---
title: Facile package sharing

<pre>

<font color="red">Him: I couldn't really install the mdtraj module on my computer [...]
Him: I tried easy_install and other things and that didn't work for me.</font>

<font color="blue">Me: Installing mdtraj should be a one line command:
Me: `conda install -c https://conda.binstar.org/omnia mdtraj`</font>

<font color="red">Him: Success!</font>

</pre>


---
title: Automating Biophysics
class: segue dark nobackground

---
title: Models are made to be broken
subtitle: How can we falsify and refine computer based models?

- Chemistry and biophysics are labor-intensive
- Thousands of parameters = thousands of measurements
- Reproducibilty and scalabity

---
title: Can experiments be easy as Py(thon)?
subtitle: (This isn't actually real yet)

<pre class="prettyprint" data-lang="python">

from robots import Robot, ITCExperiments

robot = Robot()
experiment = ITCExperiments.load('SAMPL4-CB7.exp')

robot.load_script(experiment)
robot.run()

</pre>



<footer class="source"> 
Based on work by @jhprinz <br>
https://github.com/choderalab/robots
</footer>

---
title: Robots!


<center>
<video width="960" height="540" controls>
  <source src="movies/robot.mp4" type="video/mp4">
</video>
</center> 


---
title: Biophysical modeling should be:

- Reproducible
- Automatable
- Accessible
- Tested
- Useful


---
title: People

- John Chodera + ChoderaLab (MSKCC)
- Patrick Grinaway (MSKCC)
- Vijay Pande (Stanford, Folding@Home)
- Robert McGibbon (Stanford)
- Peter Eastman (Stanford)
- Yutong Zhao (Stanford, Folding@Home)
- Joy Ku (Stanford)
- Justin MacCallum (U. Calgary)
- Jason Swails (Rutgers)

---
title: Questions?

<pre class="prettyprint" data-lang="bash">
conda install -c https://conda.binstar.org/kyleabeauchamp omnia-md
</pre>
